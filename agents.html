<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agents | Croati Mission Control</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <div class="header-brand">
      <span class="lobster-icon">ü¶û</span>
      <h1>CROATI MISSION CONTROL</h1>
      <span class="live-badge">LIVE</span>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="refreshAll()">üîÑ Refresh</button>
      <button class="btn" onclick="spawnNewAgent()">+ Spawn Agent</button>
    </div>
  </header>

  <nav class="nav">
    <ul>
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="agents.html" class="active">Agents</a></li>
      <li><a href="crons.html">Cron Jobs</a></li>
      <li><a href="missions.html">Mission Log</a></li>
    </ul>
  </nav>

  <main class="dashboard">
    <!-- Active Agents -->
    <div class="card">
      <div class="card-header">
        <h2><span>üü¢</span> ACTIVE AGENTS</h2>
      </div>
      <div class="card-body">
        <div class="agent-list" id="active-agents">
          <p class="placeholder">Loading agents...</p>
        </div>
      </div>
    </div>

    <!-- Scheduled Agents (Crons) -->
    <div class="card">
      <div class="card-header">
        <h2><span>üìÖ</span> SCHEDULED</h2>
      </div>
      <div class="card-body">
        <div class="agent-list" id="scheduled-agents">
          <p class="placeholder">Loading crons...</p>
        </div>
      </div>
    </div>

    <!-- Agent Templates -->
    <div class="card">
      <div class="card-header">
        <h2><span>üìã</span> AGENT TEMPLATES</h2>
        <span>Quick spawn pre-configured agents</span>
      </div>
      <div class="card-body">
        <div class="action-grid">
          <button class="action-btn" onclick="spawnTemplate('research')">
            <span>üîç</span> Research Agent<br><small>Web search & analysis</small>
          </button>
          <button class="action-btn" onclick="spawnTemplate('code')">
            <span>üíª</span> Code Agent<br><small>Build & ship projects</small>
          </button>
          <button class="action-btn" onclick="spawnTemplate('notion')">
            <span>üìù</span> Notion Agent<br><small>Task management</small>
          </button>
          <button class="action-btn" onclick="spawnTemplate('browser')">
            <span>üåê</span> Browser Agent<br><small>Web automation</small>
          </button>
        </div>
      </div>
    </div>
  </main>

  <script src="api-client.js"></script>
  <script>
    async function spawnNewAgent() {
      const task = prompt('Enter task for new agent:');
      if (!task || !task.trim()) return;
      showToast('Spawning agent...', 'info');
      const result = await apiCall('/agents/spawn', {
        method: 'POST',
        body: JSON.stringify({ task: task.trim(), model: 'claude' })
      });
      if (result.error) {
        showToast('Failed: ' + result.error, 'error');
      } else {
        showToast('Agent spawned!', 'success');
        loadAgents();
      }
    }

    const TEMPLATE_TASKS = {
      research: 'Research the latest developments in AI and summarize key findings',
      code: 'Review the codebase and suggest improvements to code quality and structure',
      notion: 'Sync and organize all pending tasks in Notion, flag anything overdue',
      browser: 'Browse the web and gather information as requested by the user'
    };

    async function spawnTemplate(type) {
      const task = TEMPLATE_TASKS[type];
      if (!task) return;
      if (!confirm('Spawn ' + type + ' agent?\n\n"' + task + '"')) return;
      showToast('Spawning ' + type + ' agent...', 'info');
      const result = await apiCall('/agents/spawn', {
        method: 'POST',
        body: JSON.stringify({ task, model: 'claude' })
      });
      if (result.error) {
        showToast('Failed: ' + result.error, 'error');
      } else {
        showToast(type.charAt(0).toUpperCase() + type.slice(1) + ' agent spawned!', 'success');
        loadAgents();
      }
    }

    async function loadScheduledAgents() {
      const container = document.getElementById('scheduled-agents');
      if (!container) return;
      try {
        const data = await apiCall('/crons');
        if (!data || data.error || !data.crons || !data.crons.length) {
          container.innerHTML = '<p class="placeholder">No scheduled agents</p>';
          return;
        }
        let html = '';
        for (let i = 0; i < data.crons.length; i++) {
          const c = data.crons[i];
          html += '<div class="agent-item">';
          html += '<div class="agent-name">' + escapeHtml(c.name) + '<br>';
          html += '<small style="color:var(--text-secondary)">' + escapeHtml(c.displaySchedule) + '</small></div>';
          html += '<span class="badge" style="background:#f59e0b">' + escapeHtml(c.status) + '</span>';
          html += '</div>';
        }
        container.innerHTML = html;
      } catch (e) {
        container.innerHTML = '<p class="placeholder">Failed to load</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      loadAgents();
      loadScheduledAgents();
    });
  </script>
</body>
</html>
